---
meta:
  title: How to monitor your Kubernetes Kapsule Data Plane with Cockpit
  description: This page explains how to integrate Kubernetes container logs with Scaleway Cockpit using Promtail
content:
  h1: How to monitor your Kubernetes Kapsule Data Plane with Cockpit
  paragraph: This page explains how to integrate Kubernetes container logs with Scaleway Cockpit using Promtail
categories:
  - iot-hub
tags: kubernetes kapsule kosmos cockpit promtail logs
dates:
  validation: 2025-01-17
  posted: 2025-01-17
---

You can now send **data plane** logs from your [Kapsule or Kosmos](https://www.scaleway.com/en/kubernetes) clusters to [Cockpit](https://www.scaleway.com/en/cockpit/), providing centralized, real-time access to application and system logs. Reduce complexity and manual work thanks to this integration, powered by a **Promtail** deployment via [Easy Deploy](/containers/kubernetes/how-to/enable-easy-deploy/).

With this feature:

- **Enhance observability**: View logs from all your Kubernetes containers in one place.
- **Simplify troubleshooting**: Quickly drill down into specific pods or containers without needing to configure a separate logging stack.

<Message type="important">
    This feature does incur costs based on the volume of logs ingested. Refer to [Cockpit FAQ](/faq/cockpit/#how-am-i-billed-for-using-cockpit-with-custom-data) for more details and best practices to avoid unexpected bills. |
</Message>

<Macro id="requirements" />

- A running [Kapsule](/containers/kubernetes/how-to/create-cluster/) or [Kosmos](/containers/kubernetes/how-to/create-kosmos-cluster/) cluster.
- An API Key with [IAM permissions](/identity-and-access-management/iam/reference-content/permission-sets/) to edit your cluster `(KubernetesFullAccess` or `KubernetesSystemMastersGroupAccess`)
- [A token](/observability/cockpit/how-to/create-token/) with permissions to push to, and query logs from Cockpit

## Architecture and Limitations

### Control Plane vs. Data Plane

- **Control Plane**: Fully managed by Scaleway. Users can already [monitor control plane components](/containers/kubernetes/how-to/monitor-cluster/) (e.g., `kube-apiserver`, `CCM`, `CSI`) via Cockpit.  
- **Data Plane**: Runs in your Scaleway Project (customer-managed instances, `kubelet`, `containerd`, customer Pods, etc.). You have **full access** to the data plane, including the ability to SSH into nodes.

Because the data plane is entirely under your control, **logs from any components running on these nodes are considered your own data**. Consequently, shipping these logs to Cockpit is billed based on data ingestion.

## How it works

The system leverages **Promtail** (a lightweight log collector) running on your Kapsule or Kosmos cluster. Promtail forwards logs to the Loki endpoint of your Cockpit instance:

1. **Promtail** can collect logs from:
   - **Container stdout/stderr** (pods)
   - **systemd journal** (e.g., `kubelet.service`)
2. **Log data** is transmitted to **Cockpit** (Loki).
3. **Cockpit** stores and indexes these logs.

## Step-by-step: Enabling container logs in Cockpit

You can use Scaleway’s **[Easy Deploy](/containers/kubernetes/how-to/enable-easy-deploy/)** to add a Promtail deployment to your cluster:

1. **Open the Scaleway Console** and go to your **Kubernetes** cluster.
2. Navigate to the **Easy Deploy** tab.
3. Select **Promtail for Cockpit** from the library.
4. **Deploy** the application. Promtail will install on your cluster with default settings that:
   - Collect container logs for **all namespaces** (by default).
   - Collect systemd journal logs (e.g., `kubelet.service`).
   - Forward logs securely to **Cockpit**.
  <Message type="note">
    You may edit the default configuration of the deployment to specify the sources of logs to ingest (under `config.snippets.scrapeConfigs` in the yaml file): `cockpit_promtail_scrape_config_pods: “… list of namespaces…” cockpit_promtail_scrape_config_journal: “… list of system components…”` |
  </Message>

### Example Promtail configuration

Below is a simplified snippet of the configuration that Easy Deploy generates by default:

```
config:
  clients:
    - bearer_token: "{{{ cockpit_bearer_token }}}" # no need to modify
      url: "{{{ cockpit_loki_push_url }}}" # no need to modify

  snippets:
    scrapeConfigs: |
      {{{- cockpit_promtail_scrape_config_pods }}} #default all pods are logged
      {{{- cockpit_promtail_scrape_config_journal }}} #default all system components are logged
extraVolumeMounts:
  - mountPath: /var/log/journal
    name: journal
    readOnly: true
extraVolumes:
  - hostPath:
      path: /var/log/journal
    name: journal
```

<Message type="note">
  Template values like `{{{ cockpit_bearer_token }}}` and `{{{ cockpit_loki_push_url }}}` are automatically replaced by the Easy Deploy system with your actual values. Please do not overwrite any of these two values.  |
</Message>

## Observing logs in Cockpit

Once Promtail is running:

1. Go to **Cockpit** → **Kubernetes Cluster Pod Logs** (or open your own Grafana connected to Cockpit).
2. **Filter** by:
   - `Datasource` which is automatically created upon deployment, and visible in the Cockpit console
   - `Cluster Name` ( e.g. `my-kapsule-cluster`)
   - `namespace`, `pod`, or `container` labels to isolate specific workloads
   - **Time range** to limit how far back in history you want to query
3. **Analyze** logs in real-time or historical mode to troubleshoot issues, watch for errors, or track performance.

## Usage & pricing

Sending logs to Cockpit is billed based on the **total volume of logs ingested**. You are charged *€0.15 per million log lines*\* (samples) or partial million.

Key points include:

- **Logging rate**: The more logs you produce (e.g. high-traffic workloads or verbose logging), the higher the bill.
- **Filtering**: Limit logs to critical namespaces or system components only.

<Message type="note">
  You may edit the default configuration of the deployment to adjust the volume of logs to ingest: `extraLimitsConfig: |   readline_rate_enabled: true #rate limiting   readline_rate: 10000 #log lines / sec   readline_burst: 10000 #cap for burst lines   readline_rate_drop: true #drop excess lines`
</Message>

<Message type="tip">
  Always monitor the logs ingestion rate in the dedicated dashboards provided in Cockpit, just below the log tables, to avoid surprises.
</Message>

## Security considerations

- **Authentication**: The Promtail client uses a Cockpit Bearer Token to authenticate. Keep this token secret; do not store it in publicly accessible repos.
- **Encryption**: Communication between Promtail and Cockpit (HTTPS) encrypts logs in transit.
- **Access Control**: Ensure only trusted team members can deploy Easy Deploy applications or modify cluster-level configurations.

## Troubleshooting

- **No logs appearing** in Cockpit:
  - Verify that the Promtail pod is running (`kubectl get pods -n <promtail-namespace>`).
  - Inspect Promtail logs for errors.


- **High log ingestion cost**:
  - Review your **deployment configuration** to filter out verbose logs or unneeded namespaces.
  - Check **log ingestion rate** in the dedicated dashboards for unusual spikes.

## Further Resources

- [Observability Cockpit Overview](/observability/cockpit/)
- [Push Logs to Cockpit (How-To)](/observability/cockpit/how-to/send-metrics-logs-to-cockpit/)
- [Promtail Documentation](https://grafana.com/docs/loki/latest/clients/promtail/)
- [Scaleway Kapsule Documentation](/containers/kubernetes/kapsule/quickstart/)
- [Scaleway Kosmos Documentation](/containers/kubernetes/kosmos/quickstart/)
